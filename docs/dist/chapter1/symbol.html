<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Symbol 和 Symbol 属性 | Learn-ES-Next</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" type="image/x-icon" href="/learn_es_next/favicon.ico">
    <meta name="description" content="学习ES6笔记  ---  coderdxh">
    
    <link rel="preload" href="/learn_es_next/assets/css/0.styles.c4659089.css" as="style"><link rel="preload" href="/learn_es_next/assets/js/app.10615e40.js" as="script"><link rel="preload" href="/learn_es_next/assets/js/2.7e0aeeb4.js" as="script"><link rel="preload" href="/learn_es_next/assets/js/12.9b235848.js" as="script"><link rel="prefetch" href="/learn_es_next/assets/js/10.6d2e863e.js"><link rel="prefetch" href="/learn_es_next/assets/js/11.76ab182b.js"><link rel="prefetch" href="/learn_es_next/assets/js/3.d6c372fe.js"><link rel="prefetch" href="/learn_es_next/assets/js/4.10021e72.js"><link rel="prefetch" href="/learn_es_next/assets/js/5.90a2f73f.js"><link rel="prefetch" href="/learn_es_next/assets/js/6.2b2da37a.js"><link rel="prefetch" href="/learn_es_next/assets/js/7.44c2a116.js"><link rel="prefetch" href="/learn_es_next/assets/js/8.1b3d34d5.js"><link rel="prefetch" href="/learn_es_next/assets/js/9.f4527029.js">
    <link rel="stylesheet" href="/learn_es_next/assets/css/0.styles.c4659089.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn_es_next/" class="home-link router-link-active"><!----> <span class="site-name">Learn-ES-Next</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基本</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn_es_next/chapter1/scoped.html" class="sidebar-link">块级作用域绑定</a></li><li><a href="/learn_es_next/chapter1/string.html" class="sidebar-link">字符串</a></li><li><a href="/learn_es_next/chapter1/function.html" class="sidebar-link">函数</a></li><li><a href="/learn_es_next/chapter1/object.html" class="sidebar-link">对象</a></li><li><a href="/learn_es_next/chapter1/symbol.html" aria-current="page" class="active sidebar-link">Symbol 和 Symbol 属性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn_es_next/chapter1/symbol.html#symbol-和-symbol-属性" class="sidebar-link">Symbol 和 Symbol 属性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn_es_next/chapter1/symbol.html#_1-创建-symbol" class="sidebar-link">1. 创建 Symbol</a></li><li class="sidebar-sub-header"><a href="/learn_es_next/chapter1/symbol.html#_2-symbol共享体系" class="sidebar-link">2. Symbol共享体系</a></li><li class="sidebar-sub-header"><a href="/learn_es_next/chapter1/symbol.html#_3-symbol-属性检索" class="sidebar-link">3. Symbol 属性检索</a></li><li class="sidebar-sub-header"><a href="/learn_es_next/chapter1/symbol.html#_4-通过well-known-symbol-暴露内部操作" class="sidebar-link">4. 通过well-known Symbol 暴露内部操作</a></li><li class="sidebar-sub-header"><a href="/learn_es_next/chapter1/symbol.html#_4-3-symbol-toprimitive-方法" class="sidebar-link">4.3 Symbol.toPrimitive 方法</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="symbol-和-symbol-属性"><a href="#symbol-和-symbol-属性" class="header-anchor">#</a> Symbol 和 Symbol 属性</h2> <p>​		在 ES5 早期版本，包含5种原始类型：字符串string、数字number、布尔boolean、null、undefined； ES6 引入了第 6 种原始类型：Symbol。</p> <h3 id="_1-创建-symbol"><a href="#_1-创建-symbol" class="header-anchor">#</a> 1. 创建 Symbol</h3> <p>​		可以通过全局的 Symbol 函数创建一个 Symbol，当要访问这个属性时，一定要用到最初定义的Symbol。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> firstName <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

person<span class="token punctuation">[</span>firstName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'dong'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">[</span>firstName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'dong'</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">警告</p> <p>由于Symbol是原始值，因此调用 new Symbol() 会导致程序抛出错误。</p></div> <p>​		
​   Symbol 函数接受一个可选参数，可以添加一段文本描述即将创建的Symbol。这段描述不可用于属性访问，但是建议在每次创建 Symbol 时都添加这样一段描述，以便于阅读代码和调试 Symbol 程序。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> firstName <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'first name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

person<span class="token punctuation">[</span>firstName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'dong'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'first name'</span> <span class="token keyword">in</span> person<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">[</span>firstName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'dong'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>firstName<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Symbol(first name)</span>
</code></pre></div><p>​		Symbol 的描述被存储在内部的[[Description]]属性中，只有当调用Symbol的toStrung方法时才可以读取这个属性。在执行 console.log 时隐式调用了 firstName 的 toString 方法，所以它的描述会被打印到日志中，但不能直接在代码里访问[[Description]]。</p> <div class="custom-block tip"><p class="custom-block-title">推荐</p> <p>通过其它间接方式也可以检测变量是否为 Symbol 类型，但是 typeof 操作符是最准确也是最应首选的检测方式。</p></div> <p>​		所有使用可计算属性名的地方，都可以使用 Symbol。</p> <h3 id="_2-symbol共享体系"><a href="#_2-symbol共享体系" class="header-anchor">#</a> 2. Symbol共享体系</h3> <p>​		如果想创建一个可共享的Symbol，要使用Symbol.for方法。它只接受一个参数，也就是即将创建的Symbol的字符串标识符：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> uid <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'uid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> object <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

object<span class="token punctuation">[</span>uid<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'12345'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object<span class="token punctuation">[</span>uid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// '12345'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'Symbol(uid)'</span>
</code></pre></div><p>​		Symbol.for 方法首先在全局Symbol注册表中搜索键为'uid'的Symbol是否存在，如果存在，直接返回已有的Symbol；否则，创建一个新的Symbol，并使用这个键在Symbol全局注册表中注册，随即返回新创建的Symbol。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> uid <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'uid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>uid<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'12345'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object<span class="token punctuation">[</span>uid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// '12345'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Symbol(uid)</span>

<span class="token keyword">let</span> uid2 <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'uid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uid <span class="token operator">===</span> uid2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object<span class="token punctuation">[</span>uid2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// '12345'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uid2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Symbol(uid)</span>
</code></pre></div><h3 id="_3-symbol-属性检索"><a href="#_3-symbol-属性检索" class="header-anchor">#</a> 3. Symbol 属性检索</h3> <p>​		Object.keys 方法和 Object.getOwnPropertyNames 方法可以检索对象中所有的属性名：前一个方法返回所有可枚举的属性名；后一个方法不考虑属性的可枚举性一律返回，但是它们都不支持Symbol属性。</p> <p>​		ES6中，Object.getOwnPropertySymbols 方法来检测对象中的Symbol属性，返回值是一个包含所有Symbol自有属性的数组。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> uid <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'uid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>uid<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">120899</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'coderdxh'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertySymbols</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// [Symbol(uid)]</span>
</code></pre></div><h3 id="_4-通过well-known-symbol-暴露内部操作"><a href="#_4-通过well-known-symbol-暴露内部操作" class="header-anchor">#</a> 4. 通过well-known Symbol 暴露内部操作</h3> <p>​		ES6开放了以前JavaScript中常见的内部操作，并通过预定义一些 well-know Symbol 来表示。每一个这类 Symbol 都是 Symbol 对象的一个属性。</p> <ul><li><strong>Symbol.hasInstance</strong> 一个在执行 instanceof 时调用的内部方法，用于检测对象的继承信息。</li> <li><strong>Symbol.isConcatSpreadable</strong> 一个布尔值，用于表示当传递一个集合作为 Array.prototype.concat 方法的参数时，是否应该将集合内的元素规整到同一层级。</li> <li><strong>Symbol.iterator</strong> 一个返回迭代器的方法</li> <li><strong>Symbol.speices</strong> 用于创建派生对象的构造函数。</li> <li><strong>Symbol.split</strong> 一个在调用 String.prototype.split 方法时调用的方法，用于分割字符串。</li> <li><strong>Symbol.toPrimitive</strong> 一个返回对象原始值的方法。</li> <li><strong>Symbol.toStringTag</strong> 一个在调用 Object.prototype.toString 方法时使用的字符串，用于创建对象描述</li> <li><strong>Symbol.unscopables</strong> 一个定义了一些不可被 with 语句引用的对象属性名称的集合</li></ul> <h4 id="_4-1-symbol-hasinstance"><a href="#_4-1-symbol-hasinstance" class="header-anchor">#</a> 4.1 Symbol.hasInstance</h4> <p>​		每一个函数中都有一个<strong>Symbol.hasInstance</strong>方法，用于确定对象是否为函数实例。该方法在 <strong>Function.prototype</strong> 中定义，所以所有函数都继承了 instanceof 属性的默认行为，该方法被定义为<strong>不可写，不可配置并且不可枚举</strong>。本质上，ES6 只是将 instanceof操作符重新定义为此方法的简写语法。</p> <div class="language-js extra-class"><pre class="language-js"><code>obj <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">;</span>

Array<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>hasInstance<span class="token punctuation">]</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">提示</p> <p>只有通过 Object.defineProperty 方法才能够改写一个不可写属性。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 假设想定义一个无实例的函数，就可以将Symbol.hansInstance 返回值硬编码为 false.</span>
<span class="token keyword">function</span> <span class="token function">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 空函数</span>
<span class="token punctuation">}</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>MyObject<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>hasInstance<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">MyObject</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// false</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">SpecialNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 空函数</span>
<span class="token punctuation">}</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>SpecialNumber<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>hasInstance<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>v <span class="token keyword">instanceof</span> <span class="token class-name">Number</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>v <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> v <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> two <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    zero <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>two <span class="token keyword">instanceof</span> <span class="token class-name">SpecialNumber</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>zero <span class="token keyword">instanceof</span> <span class="token class-name">SpecialNumber</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// false</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>​如果要触发Symbol.hasInstance调用，instanceof 的左操作数必须是一个对象，如果左操作数为非对象会导致 instanceof总是返回 false。</p></div> <h4 id="_4-2-symbol-isconcatspreadable-属性"><a href="#_4-2-symbol-isconcatspreadable-属性" class="header-anchor">#</a> 4.2 Symbol.isConcatSpreadable 属性</h4> <p>​		JavaScript中数组的 concat 方法被设计用于拼接两个数组，使用方法:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> colors1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    colors2 <span class="token operator">=</span> colors1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'pink'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>colors2<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 4</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>colors2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ['red', 'green', 'blue', 'pink']</span>

<span class="token keyword">let</span> colors3 <span class="token operator">=</span> colors2<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'black'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>colors3<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ['red', 'green', 'blue', 'pink', 'black', 'white']</span>
</code></pre></div><p>​		Symbol.isConcatSpreadable 属性是一个布尔值，如果该属性值为true，则表示对象有 length 属性和数字键，故它的数值属性应该被独立添加到concat调用的结果中。这个Symbol属性默认情况下不会出现在标准对象，它只是一个可选属性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> collection <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">0</span><span class="token operator">:</span> <span class="token string">'Hello'</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token string">'World'</span><span class="token punctuation">,</span>
  length<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>isConcatSpreadable<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Hello JavaScript'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>collection<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ['Hello JavaScript', 'Hello', 'World']</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 无 Symbol.isConcatSpreadable</span>
<span class="token keyword">let</span> collection <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">0</span><span class="token operator">:</span> <span class="token string">'Hello'</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token string">'World'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Hello JavaScript'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>collection<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ['Hello JavaScript', {...collection}]</span>
</code></pre></div><h3 id="_4-3-symbol-toprimitive-方法"><a href="#_4-3-symbol-toprimitive-方法" class="header-anchor">#</a> 4.3 Symbol.toPrimitive 方法</h3> <p>​		Symbol.toPrimitive 方法被定义在每一个标准类型的原型上，并且规定了当对象被转换为原始值时应当执行的操作。当执行原始值转换时，总会调用 Symbol.toPrimitive 方法并传入一个值作为参数，这个值在规范中被称为类型提示(hint)。类型提示参数的值只有三种选择：number  string  default；传递这些参数时，Symbol.toPrimitive 返回的分别是 数字 字符串或无类型偏好的值。</p> <p>​       对于大多数标准对象，<strong>数字模式</strong>有以下特性，根据优先级的顺序排列如下：</p> <ol><li><p>调用 valueOf 方法，如果结果为初始值，则返回。</p></li> <li><p>否则调用 toString 方法，如果结果为初始值，则返回。</p></li> <li><p>如果再无可选值，则抛出错误。</p></li></ol> <p>对于大多数标准对象，<strong>字符串模式</strong>有以下优先级排序：</p> <ol><li><p>调用 toString 方法，如果结果为原始值，则返回</p></li> <li><p>否则调用 valueOf 方法，如果结果为原始值，则返回</p></li> <li><p>如果再无可选值，则抛出错误</p></li></ol> <p>​        大多数情况下，标准对象会将<strong>默认模式</strong>按<strong>数字模式</strong>处理(除了Date对象，在这种情况下，会将默认模式按字符串模式处理)。</p> <p>​		如果想要覆写默认的转换特性，可以自定义 Symbol.toPrimitive 方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 普通情况</span>
<span class="token keyword">function</span> <span class="token function">Temperature</span><span class="token punctuation">(</span><span class="token parameter">degrees</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>degrees <span class="token operator">=</span> degrees<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> freezing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Temperature</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>freezing <span class="token operator">+</span> <span class="token string">'!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// '[object Object]!'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>freezing <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// NaN</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>freezing<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object Object]'</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Temperature</span><span class="token punctuation">(</span><span class="token parameter">degrees</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>degrees <span class="token operator">=</span> degrees<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Temperature</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">hint</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span><span class="token punctuation">(</span>hint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'string'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>degrees <span class="token operator">+</span> <span class="token string">'\u00b0'</span><span class="token punctuation">;</span>  <span class="token comment">// degrees symbol</span>
    <span class="token keyword">case</span> <span class="token string">'number'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>degrees<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'default'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>degrees <span class="token operator">+</span> <span class="token string">'degrees'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> freezing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Temperature</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>freezing <span class="token operator">+</span> <span class="token string">'!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// '32degress!'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>freezing <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 16</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>freezing<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '32°'</span>
</code></pre></div><p>​		+ 运算符触发默认模式，hint被设置为&quot;default&quot;；/ 运算符触发数字模式，hint 被设置为 &quot;number&quot;；String() 函数触发字符串模式，hint被设置为 &quot;string&quot;</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/learn_es_next/chapter1/object.html" class="prev">
        对象
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/learn_es_next/assets/js/app.10615e40.js" defer></script><script src="/learn_es_next/assets/js/2.7e0aeeb4.js" defer></script><script src="/learn_es_next/assets/js/12.9b235848.js" defer></script>
  </body>
</html>
