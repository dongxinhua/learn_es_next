<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>函数 | Learn-ES-Next</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" type="image/x-icon" href="/learn_es_next/favicon.ico">
    <meta name="description" content="学习ES6笔记  ---  coderdxh">
    
    <link rel="preload" href="/learn_es_next/assets/css/0.styles.c4659089.css" as="style"><link rel="preload" href="/learn_es_next/assets/js/app.0723154e.js" as="script"><link rel="preload" href="/learn_es_next/assets/js/2.7e0aeeb4.js" as="script"><link rel="preload" href="/learn_es_next/assets/js/8.1b3d34d5.js" as="script"><link rel="prefetch" href="/learn_es_next/assets/js/10.1b9149c9.js"><link rel="prefetch" href="/learn_es_next/assets/js/11.ca8a3616.js"><link rel="prefetch" href="/learn_es_next/assets/js/12.86568031.js"><link rel="prefetch" href="/learn_es_next/assets/js/13.4ba127f4.js"><link rel="prefetch" href="/learn_es_next/assets/js/14.385c51a0.js"><link rel="prefetch" href="/learn_es_next/assets/js/3.7d10c692.js"><link rel="prefetch" href="/learn_es_next/assets/js/4.10021e72.js"><link rel="prefetch" href="/learn_es_next/assets/js/5.90a2f73f.js"><link rel="prefetch" href="/learn_es_next/assets/js/6.2b2da37a.js"><link rel="prefetch" href="/learn_es_next/assets/js/7.d9769531.js"><link rel="prefetch" href="/learn_es_next/assets/js/9.ce92f261.js">
    <link rel="stylesheet" href="/learn_es_next/assets/css/0.styles.c4659089.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn_es_next/" class="home-link router-link-active"><!----> <span class="site-name">Learn-ES-Next</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基本</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn_es_next/chapter1/scoped.html" class="sidebar-link">块级作用域绑定</a></li><li><a href="/learn_es_next/chapter1/string.html" class="sidebar-link">字符串</a></li><li><a href="/learn_es_next/chapter1/function.html" aria-current="page" class="active sidebar-link">函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn_es_next/chapter1/function.html#_1-es6默认参数值" class="sidebar-link">1. ES6默认参数值</a></li><li class="sidebar-sub-header"><a href="/learn_es_next/chapter1/function.html#_2-默认参数值对-arguments-对象的影响" class="sidebar-link">2. 默认参数值对 arguments 对象的影响</a></li><li class="sidebar-sub-header"><a href="/learn_es_next/chapter1/function.html#_3-默认参数表达式" class="sidebar-link">3. 默认参数表达式</a></li><li class="sidebar-sub-header"><a href="/learn_es_next/chapter1/function.html#_4-不定参数" class="sidebar-link">4. 不定参数</a></li><li class="sidebar-sub-header"><a href="/learn_es_next/chapter1/function.html#_5-元属性-new-target" class="sidebar-link">5. 元属性 new.target</a></li><li class="sidebar-sub-header"><a href="/learn_es_next/chapter1/function.html#_6-箭头函数" class="sidebar-link">6. 箭头函数</a></li><li class="sidebar-sub-header"><a href="/learn_es_next/chapter1/function.html#_7-尾调用" class="sidebar-link">7. 尾调用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn_es_next/chapter1/function.html#_7-1-es6中的尾调用优化" class="sidebar-link">7.1 ES6中的尾调用优化</a></li><li class="sidebar-sub-header"><a href="/learn_es_next/chapter1/function.html#_7-2-如何利用尾调用优化" class="sidebar-link">7.2 如何利用尾调用优化</a></li></ul></li></ul></li><li><a href="/learn_es_next/chapter1/object.html" class="sidebar-link">对象</a></li><li><a href="/learn_es_next/chapter1/symbol.html" class="sidebar-link">Symbol 和 Symbol 属性</a></li><li><a href="/learn_es_next/chapter1/set-map.html" class="sidebar-link">Set集合与Map集合</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>提升</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn_es_next/chapter2/iterator.html" class="sidebar-link">迭代器与生成器</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="函数"><a href="#函数" class="header-anchor">#</a> 函数</h1> <h2 id="_1-es6默认参数值"><a href="#_1-es6默认参数值" class="header-anchor">#</a> 1. ES6默认参数值</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">12</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 10 12</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_2-默认参数值对-arguments-对象的影响"><a href="#_2-默认参数值对-arguments-对象的影响" class="header-anchor">#</a> 2. 默认参数值对 arguments 对象的影响</h2> <p>​		ES5 非严格模式:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">===</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// true</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token operator">===</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// true</span>
  a <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
  b <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">===</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// true</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token operator">===</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// true</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>​		ES5 严格模式：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">'use strict'</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">===</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// true</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token operator">===</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// true</span>
  a <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
  b <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">===</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// false</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token operator">===</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// false</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>​		可见，在ES5严格模式下，取消了 arguments 对象的困惑行为，无论参数如何变化，arguments对象不再随之改变。</p> <p><strong>ES6 默认参数值：</strong></p> <p>​		在ES6中，如果一个函数使用了默认参数值，则不误是否显式定义了严格模式，arguments对象的行为都将与 ES5 严格模式下保持一致。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">20</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">===</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// true</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token operator">===</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// false   arguments[1] -&gt; undefined  b -&gt; 20</span>
  a <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
  b <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">===</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// false   arguments[0] -&gt; 10  a -&gt; 30</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token operator">===</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// false   arguments[1] -&gt; undefined  b -&gt; 40</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_3-默认参数表达式"><a href="#_3-默认参数表达式" class="header-anchor">#</a> 3. 默认参数表达式</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 形参默认值可以是一个函数的调用</span>
<span class="token keyword">function</span> <span class="token function">getVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token function">getVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 20</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 30</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 后边的参数可以访问前边的参数值</span>
<span class="token keyword">function</span> <span class="token function">getVal</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> val<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token function">getVal</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 40</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 30</span>
</code></pre></div><p>​		在引用参数默认值的时候，只允许引用前边参数的值，即先定义的参数不能访问后定义的参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a <span class="token operator">=</span> b<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 抛出错误  Cannot access 'b' before initialization  初始化前无法访问'b'</span>
</code></pre></div><p>​		函数参数有自己的作用域和临时死区，其与函数体的作用域是各自独立的，也就是说参数的默认值不可访问函数体内声明的变量。</p> <h2 id="_4-不定参数"><a href="#_4-不定参数" class="header-anchor">#</a> 4. 不定参数</h2> <p>​		在函数的命名参数前添加三个点(...)就表明这是一个不定参数，该参数为一个数组，包含着自它之后传入的所有参数，通过这个数组逐一访问里面的参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">pick</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>​		每个函数最多只能声明一个不定参数，而且一定要放在所有参数的末尾。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> <span class="token operator">...</span>b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// 语法错误：不定参数后不能有其他命名参数</span>
</code></pre></div><h2 id="_5-元属性-new-target"><a href="#_5-元属性-new-target" class="header-anchor">#</a> 5. 元属性 new.target</h2> <p>​		元属性是指非对象的属性，其可以提供非对象目标的补充信息。当调用函数的**[[Construct]]<strong>方法时，new.target 被赋值为 new 操作符的目标，通常是新创建对象实例，也就是函数体内 this 的构造函数；如果调用</strong>[[Call]]**方法，则 new.target 的值为 undefined。</p> <p>​		在函数外使用 new.target 是一个语法错误。</p> <h2 id="_6-箭头函数"><a href="#_6-箭头函数" class="header-anchor">#</a> 6. 箭头函数</h2> <p>​		在ES6中，箭头函数是一种使用箭头(=&gt;)定义函数的新语法，与传统的 JavaScript 函数有些许不同，主要集中在以下方面：</p> <ul><li><strong>没有this、super、arguments 和 new.target 绑定</strong>  箭头函数中的 <strong>this</strong>、<strong>super</strong>、<strong>arguments</strong> 及 <strong>new.target</strong> 这些值由外围最近一层非箭头函数决定。</li> <li><strong>不能通过 new 关键字调用</strong>  箭头函数没有 <strong>[[Construct]]</strong> 方法，所以不能被用作构造函数，如果通过 <strong>new</strong> 关键字调用箭头函数，程序会抛出错误。</li> <li><strong>没有原型</strong>  由于不可以通过 new 关键字调用箭头函数，因而没有构建原型的需求，所以箭头函数不存在 <strong>prototype</strong> 这个属性。</li> <li><strong>不可以绑定 this 的绑定</strong>  函数内部的 <strong>this</strong> 值不可被改变，在函数的生命周期内始终保持一致。如果箭头函数被非箭头函数包含，则 this 绑定的是最近一层非箭头函数的 this；否则，this 的值会被设置为全局对象。</li> <li><strong>不支持 arguments 对象</strong>  箭头函数没有 <strong>arguments</strong> 绑定，所以必须通过<strong>命名参数</strong>和<strong>不定参数</strong>这两种形式访问函数的参数。</li> <li><strong>不支持重复的命名参数</strong>  无论在严格还是非严格模式下，箭头函数都不支持重复的命名参数：在传统函数的规定中，只有在严格模式下才不能有重复的命名参数。</li></ul> <h2 id="_7-尾调用"><a href="#_7-尾调用" class="header-anchor">#</a> 7. 尾调用</h2> <p>​		尾调用指的是函数作为另一个函数的最后一条语句被调用（不一定是 return）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 尾调用</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 尾调用</span>
<span class="token punctuation">}</span>
</code></pre></div><p>​		在ES5中，尾调用的实现与其他函数调用的实现类似：创建一个新的栈帧(stack frame)，将其推入调用栈来表示函数调用。在循环调用中，每一个未用完的栈帧都会被保存在内存中，当调用栈变得过大时会造成程序问题。</p> <h3 id="_7-1-es6中的尾调用优化"><a href="#_7-1-es6中的尾调用优化" class="header-anchor">#</a> 7.1 ES6中的尾调用优化</h3> <p>​		<strong>ES6 缩减了严格模式下尾调用栈的大小(非严格模式下不受影响)，如果满足以下条件，尾调用不再创建新的栈帧，而是清除并重用当前栈帧</strong>：</p> <ul><li>尾调用不访问当前栈帧的变量(也就是说函数不是一个闭包)。</li> <li>在函数内部，尾调用是最后一条语句。</li> <li>尾调用的结果作为函数值返回。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 优化后</span>
  <span class="token keyword">return</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 无返回，无法优化</span>
  <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>​		同样的，如果定义了一个函数，在尾调用返回后执行其他操作，则函数也无法得到优化：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 无法优化，必须在返回值后添加其他操作</span>
  <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>​		还有一种意外情况，如果把函数调用的结果存储在一个变量里，最后再返回这个变量，则可能导致引擎无法优化：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 无法优化，调用不在尾部</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>​		最难避免的情况是闭包的使用，它可以访问作用域中所有的变量，因而导致尾调用优化失效：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> num<span class="token punctuation">;</span>
  
  <span class="token comment">// 无法优化，该函数是一个闭包</span>
  <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-2-如何利用尾调用优化"><a href="#_7-2-如何利用尾调用优化" class="header-anchor">#</a> 7.2 如何利用尾调用优化</h3> <p>​		实际上，尾调用的优化发生在引擎背后，除非尝试优化一个函数，否则无须思考此类问题。递归函数是其最主要的应用场景，此时尾调用优化的效果最显著。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 无法优化，必须在返回后执行乘法操作  也就是说，此处进行了其他操作</span>
    <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> p <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">*</span> p<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> n <span class="token operator">*</span> p<span class="token punctuation">;</span>
    
    <span class="token comment">// 优化后</span>
    <span class="token keyword">return</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/learn_es_next/chapter1/string.html" class="prev">
        字符串
      </a></span> <span class="next"><a href="/learn_es_next/chapter1/object.html">
        对象
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/learn_es_next/assets/js/app.0723154e.js" defer></script><script src="/learn_es_next/assets/js/2.7e0aeeb4.js" defer></script><script src="/learn_es_next/assets/js/8.1b3d34d5.js" defer></script>
  </body>
</html>
